#!/usr/bin/env python2
# -*- coding: utf8 -*-
import sys, os
from PIL import Image, ImageOps, ImageFont, ImageDraw
import tracery, json
import disarticulate
from random import Random
random=Random()
holzer=[
"a little knowledge can go a long way", "a lot of professionals are crackpots", "a man can't know what it is to be a mother", "a name means a lot just by itself", "a positive attitude means all the difference in the world", "a relaxed man is not necessarily a better man", "a sense of timing is the mark of genius", "a sincere effort is all you can ask",
"a single event can have infinitely many interpretations", "a solid home base builds a sense of self", "a strong sense of duty imprisons you", "absolute submission can be a form of freedom", "abstraction is a type of decadence", "abuse of power comes as no surprise", "action causes more trouble than thought", "alienation produces eccentrics or revolutionaries",
"all things are delicately interconnected", "ambition is just as dangerous as complacency", "ambivalence can ruin your life", "an elite is inevitable", "anger or hate can be a useful motivating force", "animalism is perfectly healthy", "any surplus is immoral", "anything is a legitimate area of investigation", "artificial desires are despoiling the earth",
"at times inactivity is preferable to mindless functioning", "at times your unconsciousness is truer than your conscious mind", "automation is deadly", "awful punishment awaits really bad people", "bad intentions can yield good results", "being alone with yourself is increasingly unpopular", "being happy is more important than anything else", "being judgmental is a sign of life",
"being sure of yourself means you're a fool", "believing in rebirth is the same as admitting defeat", "boredom makes you do crazy things", "calm is more conductive to creativity than is anxiety", "categorizing fear is calming", "change is valuable when the oppressed become tyrants", "chasing the new is dangerous to society", "children are the most cruel of all",
"children are the hope of the future", "class action is a nice idea with no substance", "class structure is as artificial as plastic", "confusing yourself is a way to stay honest", "crime against property is relatively unimportant", "decadence can be an end in itself", "decency is a relative thing", "dependence can be a meal ticket", "description is more important than metaphor",
"deviants are sacrificed to increase group solidarity", "disgust is the appropriate response to most situations", "disorganization is a kind of anesthesia", "don't place to much trust in experts", "drama often obscures the real issues", "dreaming while awake is a frightening contradiction", "dying and coming back gives you considerable perspective",
"dying should be as easy as falling off a log", "eating too much is criminal", "elaboration is a form of pollution", "emotional responses ar as valuable as intellectual responses", "enjoy yourself because you can't change anything anyway", "ensure that your life stays in flux", "even your family can betray you", "every achievement requires a sacrifice", "everyone's work is equally important",
"everything that's interesting is new", "exceptional people deserve special concessions", "expiring for love is beautiful but stupid", "expressing anger is necessary", "extreme behavior has its basis in pathological psychology", "extreme self-consciousness leads to perversion", "faithfulness is a social not a biological law", "fake or real indifference is a powerful personal weapon",
"fathers often use too much force", "fear is the greatest incapacitator", "freedom is a luxury not a necessity", "giving free rein to your emotions is an honest way to live", "go all out in romance and let the chips fall where they may", "going with the flow is soothing but risky", "good deeds eventually are rewarded", "government is a burden on the people", "grass roots agitation is the only hope",
"guilt and self-laceration are indulgences", "habitual contempt doesn't reflect a finer sensibility", "hiding your emotions is despicable", "holding back protects your vital energies", "humanism is obsolete", "humor is a release", "ideals are replaced by conventional goals at a certain age", "if you aren't political your personal life should be exemplary", "if you can't leave your mark give up",
"if you have many desires your life will be interesting", "if you live simply there is nothing to worry about", "ignoring enemies is the best way to fight", "illness is a state of mind", "imposing order is man's vocation for chaos is hell", "in some instances it's better to die than to continue", "inheritance must be abolished", "it can be helpful to keep going no matter what",
"it is heroic to try to stop time", "it is man's fate to outsmart himself", "it is a gift to the world not to have babies", "it's better to be a good person than a famous person", "it's better to be lonely than to be with inferior people", "it's better to be naive than jaded", "it's better to study the living fact than to analyze history", "it's crucial to have an active fantasy life",
"it's good to give extra money to charity", "it's important to stay clean on all levels", "it's just an accident that your parents are your parents", "it's not good to hold too many absolutes", "it's not good to operate on credit", "it's vital to live in harmony with nature", "just believing something can make it happen", "keep something in reserve for emergencies",
"killing is unavoidable but nothing to be proud of", "knowing yourself lets you understand others", "knowledge should be advanced at all costs", "labor is a life-destroying activity", "lack of charisma can be fatal", "leisure time is a gigantic smoke screen", "listen when your body talks", "looking back is the first sign of aging and decay", "loving animals is a substitute activity",
"low expectations are good protection", "manual labor can be refreshing and wholesome", "men are not monogamous by nature", "moderation kills the spirit", "money creates taste", "monomania is a prerequisite of success", "morals are for little people",  "most people are not fit to rule themselves","mostly you should mind your own business", "mothers shouldn't make too many sacrifices",
"much was decided before you were born", "murder has its sexual side", "myth can make reality more intelligible", "noise can be hostile", "nothing upsets the balance of good and evil", "occasionally principles are more valuable than people", "offer very little information about yourself", "often you should act like you are sexless", "old friends are better left in the past",
"opacity is an irresistible challenge", "pain can be a very positive thing", "people are boring unless they are extremists", "people are nuts if they think they are important", "people are responsible for what they do unless they are insane", "people who don't work with their hands are parasites", "people who go crazy are too sensitive", "people won't behave if they have nothing to lose",
"physical culture is second best", "planning for the future is escapism", "playing it safe can cause a lot of damage in the long run", "politics is used for personal gain", "potential counts for nothing until it's realized", "private property created crime", "pursuing pleasure for the sake of pleasure will ruin you", "push yourself to the limit as often as possible",
"raise boys and girls the same way", "random mating is good for debunking sex myths", "rechanneling destructive impulses is a sign of maturity", "recluses always get weak", "redistributing wealth is imperative", "relativity is no boon to mankind", "religion causes as many problems as it solves", "remember you always have freedom of choice", "repetition is the best way to learn",
"resolutions serve to ease our conscience", "revolution begins with changes in the individual", "romantic love was invented to manipulate women", "routine is a link with the past", "routine small excesses are worse than then the occasional debauch", "sacrificing yourself for a bad cause is not a moral act", "salvation can't be bought and sold", "self-awareness can be crippling",
"self-contempt can do more harm than good", "selfishness is the most basic motivation", "selflessness is the highest achievement", "separatism is the way to a new beginning", "sex differences are here to stay", "sin is a means of social control", "slipping into madness is good for the sake of comparison", "sloppy thinking gets worse over time", "solitude is enriching",
"sometimes science advances faster than it should", "sometimes things seem to happen of their own accord", "spending too much time on self-improvement is antisocial", "starvation is nature's way", "stasis is a dream state", "sterilization is a weapon of the rulers", "strong emotional attachment stems from basic insecurity", "stupid people shouldn't breed", "survival of the fittest applies to men and animals",
"symbols are more meaningful than things themselves", "taking a strong stand publicizes the opposite position", "talking is used to hide one's inability to act", "teasing people sexually can have ugly consequences", "technology will make or break us", "the cruelest disappointment is when you let yourself down", "the desire to reproduce is a death wish", "the family is living on borrowed time",
"the idea of revolution is an adolescent fantasy", "the idea of transcendence is used to obscure oppression", "the idiosyncratic has lost its authority", "the most profound things are inexpressible", "the mundane is to be cherished", "the new is nothing but a restatement of the old", "the only way to be pure is to stay by yourself", "the sum of your actions determines what you are",
"the unattainable is invariable attractive", "the world operates according to discoverable laws", "there are too few immutable truths today", "there's nothing except what you sense", "there's nothing redeeming in toil", "thinking too much can only cause problems", "threatening someone sexually is a horrible act", "timidity is laughable", "to disagree presupposes moral integrity",
"to volunteer is reactionary", "torture is barbaric", "trading a life for a life is fair enough", "true freedom is frightful", "unique things must be the most valuable", "unquestioning love demonstrates largesse of spirit", "using force to stop force is absurd", "violence is permissible even desirable occasionally", "war is a purification rite", "we must make sacrifices to maintain our quality of life",
"when something terrible happens people wake up", "wishing things away is not effective", "with perseverance you can discover any truth", "words tend to be inadequate", "worrying can help you prepare", "you are a victim of the rules you live by", "you are guileless in your dreams", "you are responsible for constituting the meaning of things", "you are the past present and future", 
"you can live on through your descendants", "you can't expect people to be something they're not", "you can't fool others if you're fooling yourself", "you don't know what's what until you support yourself", "you have to hurt others to be extraordinary", "you must be intimate with a token few", "you must disagree with authority figures", "you must have one grand passion",
"you must know where you stop and the world begins", "you can understand someone of your sex only", "you owe the world not the other way around", "you should study as much as possible", "your actions ae pointless if no one notices", "your oldest fears are the worst ones" ]
holzer+=["what is the worst thing you've ever done", "what is my next thought going to be?","why am i here?","i wish you well","i want you to be happy","what if i said no?","how can i be stronger for this?","what books changed your life?","does anger make this better?","am i being kind or clever?","is this getting me closer to my ideal life?","does this stop me from acting with justice?","does this stop me from acting with courage?","does this stop me from acting with temperance?","does this stop me from acting with wisdom?","why do i care what they think?","do i care what they think?","is this something only i can do?","who owns who?","where does this person fit into the world?","what am i working to get better at?","what can i let go of?","who do you spend time with?","is this in my control?","what does your ideal day look like?","to be or to do?","if i am not for me, who is?","if i am only for me, who am i?","what am i missing by choosing to worry?","what am i missing by choosing to be afraid?","am i doing my job?","what is the most important thing?","who is this for?","what do they want?","what do they need?","what value am i offering them?","does this actually matter?","will this be alive time or dead time?","is this who i want to be?","what am i for?","what is my job?","who do i want to be?","what is up to me?","what does a good day look like?"]
holzer+=["Is this something that I want or need to memorize?","Does this remind me of anything in another unrelated domain of knowledge?","Can I think of anything else I know that contradicts this concept?","What other things that I already know support the veracity of this concept?","Can I think of any practical examples of this?","Is this the first time that I’ve come across this nugget of knowledge?","Where else have I come across this idea?","Who else has tried to teach me this before?","How certain am I that this is true and correct?","Does this relate to anything else that I already know?","Where else in life can I find an example of this?","What other related concepts come to mind?","How difficult was it for me to grasp this?","If this is a WHAT, then can I explain the WHY?","How can this information be applied in my life?","Why is this important to know?","What else do I know about this topic?","What else would I like to learn about this subject?","Do I fully understand this?","Can I break this down into smaller parts?","How would I explain this to a child?","How does this fit in with the rest of what I know about this subject?","Is this information reliable?","Is this totally believable?","What, if anything, surprises me about this?","Is this easy to grasp?","Do I find this interesting and why?","How can I apply this it the real world?","Why is this important to know?","Am I curious to learn more about this?","What else might I want to learn more about because of this?","What does this mean to me?","Do I need to consult another source to better understand this?","What questions does this raise for me?","Does this have any broader implications?","Why is this important?","What other ways could I express this concept?","Does this bring any examples to mind?","Would I like to be able to remember this forever?","Should I consult another source?","How would I succinctly summarize this?"]
holzer+=["","Abandon desire","Abandon normal instructions","Abandon normal instruments.","Accept advice","Accept advice.","Accretion","Accretion.","Adding on","A line has two sides","A line has two sides.","Allow an easement (an easement is the abandonment of a stricture)","Allow an easement (an easement is the abandonment of a stricture).","Always first steps","Always first steps.","Always give yourself credit for having more than personality","Always give yourself credit for having more than personality.","Always the first steps","Are there sections?","Are there sections? Consider transitions","Ask people to work against their better judgement","Ask people to work against their better judgment.","Ask your body","Ask your body.","Assemble some of the elements in a group and treat the group","Assemble some of the elements in a group and treat the group.","A very small object. Its center.","A very small object -Its centre","Back up a few steps. What else could you have done?","Balance the consistency principle with the inconsistency principle","Balance the consistency principle with the inconsistency principle.","Be dirty","Be dirty.","Be extravagant","Be extravagant.","Be less critical more often","Be less critical more often.","Breathe more deeply","Breathe more deeply.","Bridges -build -burn","Bridges -build -burn.","Call your mother and ask her what to do.","Cascades","Cascades.","Change ambiguities to specifics","Change instrument roles","Change instrument roles.","Change nothing and continue with immaculate consistency","Change nothing and continue with immaculate consistency.","Change specifics to ambiguities","Children -speaking -singing.","Children's voices -speaking -singing","Close","Cluster analysis","Cluster analysis.","Consider different fading systems","Consider different fading systems.","Consider transitions","Consider transitions.","Consult other sources -promising -unpromising","Consult other sources -promising -unpromising.","Convert a melodic element into a rhythmic element","Convert a melodic element into a rhythmic element.","Courage!","Cut a vital connection","Cut a vital connection.","Decorate, decorate","Decorate, decorate.","Define an area as 'safe' and use it as an anchor.","Define an area as `safe' and use it as an anchor","Describe the landscape in which this belongs. (9 August)","Destroy nothing; Destroy the most important thing","Destroy -nothing -the most important thing.","Discard an axiom","Discard an axiom.","Disciplined self-indulgence","Disciplined self-indulgence.","Disconnect from desire","Disconnect from desire.","Discover the recipes you are using and abandon them","Discover the recipes you are using and abandon them.","Discover your formulas and abandon them","Display your talent","Distorting time","Distorting time.","Do nothing for as long as possible","Do nothing for as long as possible.","Don't avoid what is easy","Don't be afraid of things because they're easy to do","Don't be afraid of things because they're easy to do.","Don't be frightened of cliches","Don't be frightened of cliches.","Don't be frightened to display your talents","Don't be frightened to display your talents.","Don't break the silence","Don't break the silence.","Don't stress one thing more than another","Don't stress one thing more than another.","Do something boring","Do something boring.","Do something sudden, destructive and unpredictable","Do the last thing first","Do the washing up","Do the washing up.","Do the words need changing?","Do we need holes?","Emphasize differences","Emphasize differences.","Emphasize repetitions","Emphasize repetitions.","Emphasize the flaws","Emphasize the flaws.","Faced with a choice, do both","Faced with a choice, do both.","Feedback recordings into an acoustic situation","Feed the recording back out of the medium","Feed the recording back out of the medium.","Fill every beat with something","Fill every beat with something.","Find a safe part and use it as an anchor","First work alone, then work in unusual pairs.","from it? What could you take from it?","From nothing to more than nothing","From nothing to more than nothing.","Get your neck massaged","Get your neck massaged.","Ghost echoes","Ghost echoes.","Give the game away","Give the game away.","Give way to your worst impulse","Give way to your worst impulse.","Go outside. Shut the door.","Go slowly all the way round the outside","Go slowly all the way round the outside.","Go to an extreme, move back to a more comfortable place","Go to an extreme, move back to a more comfortable place.","Honor thy error as a hidden intention.","How would someone else do it?","How would you explain this to your parents?","How would you have done it?","Humanize something free of error.","Humanize something that is free of error.","Idiot glee (?)","Idiot glee (?).","Imagine a caterpillar moving.","Imagine the music as a moving chain or caterpillar","Imagine the music as a series of disconnected events","Imagine the piece as a set of disconnected events.","improve his virility shovels them straight into his lap)","Infinitesimal gradations","Infinitesimal gradations.","Instead of changing the thing, change the world around it.","Intentions -credibility of -nobility of -humility of","Intentions -nobility of -humility of -credibility of.","In total darkness, or in a very large room, very quietly","In total darkness, or in a very large room, very quietly.","Into the impossible","Into the impossible.","Is it finished?","Is something missing?","Is the intonation correct?","Is there something missing?","Is the style right?","Is the tuning appropriate?","Is the tuning intonation correct?","It is quite possible (after all)","It is quite possible (after all).","It is simply a matter or work","Just carry on","Just carry on.","Left channel, right channel, center channel.","Left channel, right channel, centre channel","Listen in total darkness, or in a very large room, very quietly","Listen to the quiet voice","Listen to the quiet voice.","List the qualities it has. List those you'd like.","Look at a very small object, look at its center.","Look at a very small object, look at its centre","Look at the order in which you do things","Look at the order in which you do things.","Look closely at the most embarrassing details and amplify.","Look closely at the most embarrassing details and amplify them.","Lost in useless territory","Lost in useless territory.","Lowest common denominator.","Lowest common denominator check -single beat -single note -single riff","Magnify the most difficult details","Make a blank valuable by putting it in an excquisite frame","Make a blank valuable by putting it in an exquisite frame.","Make an exhaustive list of everything you might do and do the last thing","Make an exhaustive list of everything you might do and do the last thing on the list.","Make a sudden, destructive unpredictable action; incorporate","Make a sudden, destructive unpredictable action; incorporate.","Make it more sensual","Make what's perfect more human","Mechanize something idiosyncratic","Mechanize something idiosyncratic.","Move towards the unimportant","Mute and continue","Mute and continue.","Not building a wall but making a brick","Not building a wall but making a brick.","Once the search has begun, something will be found","Once the search is in progress, something will be found.","Only a part, not the whole","Only a part, not the whole.","Only one element of each kind","Only one element of each kind.","on the list","(Organic) machinery","(Organic) machinery.","Overtly resist change","Overtly resist change.","Pae White's non-blank graphic metacard","Pay attention to distractions","Picture of a man spotlighted","Put in ear plugs.","Put in earplugs","Question the heroic approach","Question the heroic approach.","Reevaluation (a warm feeling).","Remember those quiet evenings","Remember those quiet evenings.","Remove ambiguities and convert to specifics","Remove ambiguities and convert to specifics.","Remove a restriction","Remove specifics and convert to ambiguities","Remove specifics and convert to ambiguities.","Remove the middle, extend the edges","Repetition is a form of change","Repetition is a form of change.","Retrace your steps","Retrace your steps.","Revaluation (a warm feeling)","Reverse","Reverse.","Short circuit (example; a man eating peas with the idea that they will","Short circuit (example; a man eating peas with the idea that they will improve his virility shovels them straight into his lap).","Shut the door and listen from outside","Simple subtraction","Simple subtraction.","Simply a matter of work","Simply a matter of work.","Slow preparation, fast execution","Spectrum analysis","Spectrum analysis.","State the problem in words as clearly as possible.","State the problem in words as simply as possible","Steal a solution.","Take a break","Take a break.","Take away as much mystery as possible. What is left?","Take away the elements in order of apparent non-importance","Take away the elements in order of apparent non-importance.","Take away the important parts","Tape your mouth","Tape your mouth.","The inconsistency principle","The inconsistency principle.","The most important thing is the thing most easily forgotten","The most important thing is the thing most easily forgotten.","The tape is now the music","The tape is now the music.","Think - inside the work -outside the work","Think of the radio","Think of the radio.","Tidy up","Tidy up.","Towards the insignificant","Towards the insignificant.","Trust in the you of now","Trust in the you of now.","Try faking it","Turn it upside down","Turn it upside down.","Twist the spine","Twist the spine.","Use an old idea","Use an old idea.","Use an unacceptable color","Use an unacceptable color.","Use cliches","Use fewer notes","Use fewer notes.","Use filters","Use filters.","Use something nearby as a model","Use 'unqualified' people.","Use your own ideas","Voice your suspicions","Water","Water.","What are the sections sections of?","What are the sections sections of? Imagine a caterpillar moving","What are you really thinking about just now?","What context would look right?","What do you do? Now, what do you do best?","What else is this like?","What is the reality of the situation?","What is the simplest solution?","What mistakes did you make last time?","What most recently impressed you? How is it similar? What can you learn","What to increase? What to reduce? What to maintain?","What were the branch points in the evolution of this entity","What were you really thinking about just now? Incorporate","What would make this really successful?","What wouldn't you do?","What would your closest friend do?","When is it for? Who is it for?","Where is the edge?","Which parts can be grouped?","Who would make this really successful?","Work at a different speed","Work at a different speed.","Would anybody want it?","Would anyone want it?","You are an engineer","You are an engineer.","You can only make one dot at a time","You can only make one dot at a time.","You don't have to be ashamed of using your own ideas","You don't have to be ashamed of using your own ideas.","Your mistake was a hidden intention"]
holzer+=["we should be vigilant against anything that appears too familiar", "beneath the cobblestones, the beach", "be realistic: demand the impossible", "protection when you least expect it", "routine is a link with the past", "in an infinite universe, even nothing is possible", "support free enterprise: shoplift", "if you are looking for a sign, this is it", "this sign is not for you", "what's stopping you?", "they know", "there is no enemy anywhere", "stasis is the most potent force for change", "common sense is neither", "patriotism is for foreigners", "black sheep are still sheep", "alarm clocks kill dreams", "finishing is for quitters", "illusion is a revolutionary weapon", "you are now aware of your tongue", "you are now breathing manually", "are you blinking at the normal rate?", "to disagree presupposes moral integrity", "no us, no them: only the universe", "reality lacks discretionary power", "preserve disorder", "fools seldom differ", "think outside which box?", "what you change, changes you.", "freedom needs work.", "freedom is half off", "real men don't essentialize gender", "smash the state of mind", "this is the only warning i'm allowed to give you", "a conclusion is simply where you stopped thinking", "does anger make this better?", "am i being kind or clever?", "what if i said no?", "do i care what they think?", "why do i care what they think?", "what can i let go of?", "who is this for?", "do you believe that?", "the mind can only suspend so much disbelief"]
grammar1=tracery.Grammar(json.load(open("holzer_markov.json", "r")))
grammar2=tracery.Grammar(json.load(open("templates/proverbs_tracery.json", "r")))
#grammar3=tracery.Grammar(json.load(open("templates/memebombs_combined.json", "r")))
#slogan=random.choice([random.choice(holzer), random.choice([grammar1.flatten("#origin#"), grammar1.flatten("#origin#"), grammar2.flatten("#origin#"), grammar3.flatten("#origin#")])])
#slogan=random.choice([random.choice(holzer), random.choice([grammar1.flatten("#origin#"), grammar2.flatten("#origin#")])])
slogan=random.choice(holzer);
slogan=random.choice([slogan, slogan.upper(), slogan.upper(), slogan.upper(), disarticulate.disarticulate(slogan, random.randint(1, 15))])

print(slogan)

try:
    font=ImageFont.truetype("arialbi.ttf", 64)
except:
    try:
        font=ImageFont.truetype("arial.ttf", 64)
    except:
        font=ImageFont.load_default()
size=font.getsize(slogan)
sloganRender=Image.new("RGB", (size[0]+10, size[1]+10), color="red")
sloganDraw=ImageDraw.Draw(sloganRender)
sloganDraw.text((5, 5), slogan, font=font, fill="white")

candidates=[]
def walk_helper(arg, dirname, fnames):
    for item in fnames:
        fullpath=os.path.join(dirname, item)
        if not (os.path.isdir(fullpath)):
            candidates.append(fullpath)
for path in sys.argv[1:]:
    if(os.path.isdir(path)):
        os.path.walk(path, walk_helper, None)
    else:
        candidates.append(path)
random.shuffle(candidates)
bg=None
for item in candidates:
    try:
        bg=Image.open(item)
        break
    except:
        pass
bg.paste(ImageOps.grayscale(bg), (0, 0))
bg2=Image.new("RGB", bg.size)
bg2.paste(bg, (0, 0))
bg=bg2
while sloganRender.size[0]>bg.size[0] or sloganRender.size[1]>bg.size[1]:
    sloganRender=sloganRender.resize((sloganRender.size[0]/2, sloganRender.size[1]/2))
bg.paste(sloganRender, (bg.size[0]/2-sloganRender.size[0]/2, bg.size[1]/2-sloganRender.size[1]/2))
bg.save("barbara_holzer.png")


